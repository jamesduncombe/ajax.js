!function(t){function e(t){if(this.method=t.method||o[0],this.url=t.url,this.data=t.data||{},this.token=t.token||r(),this.onSuccess=t.onSuccess||s,this.onError=t.onError||s,this.onStart=t.onStart||s,this.onFinish=t.onFinish||s,this.onTimeout=t.onTimeout||s,this.timeout=t.timeout||0,this.type=t.type||i[0],this.headers=t.headers||[],"undefined"==typeof t.url)throw new Error("Ajax requires a url.");if(-1===o.indexOf(this.method))throw new Error("Ajax method must be valid.");if(-1===i.indexOf(this.type))throw new Error("Ajax content type must be valid.");return this.headers.push({key:"Content-Type",value:u(this)}),this.token&&this.headers.push({key:"X-CSRF-Token",value:this.token}),this}var n={URLENCODED:"application/x-www-form-urlencoded",JSON:"application/json"},i=function(){out=[];for(var t in n)out.push(t);return out}(),o=["GET","POST","PUT","HEAD","DELETE","OPTIONS","TRACE","CONNECT"],r=function(){var t=document.getElementsByName("csrf-token")[0];return"undefined"!==t&&null!=t?t.content:null},s=function(){},u=function(t){return n[t.type]},a=function(t){var e=new XMLHttpRequest;return"withCredentials"in e?e.open(t.method,t.url,!0):"undefined"!=typeof XDomainRequest&&(e=new XDomainRequest,e.open(t.method,t.url)),e.timeout=t.timeout,setHeaders(t,e),e},h=function(t,e){e.addEventListener("timeout",t.onTimeout(e),!1),t.onStart(e),e.addEventListener("readystatechange",function(){4===this.readyState&&(200===this.status?t.onSuccess(this):t.onError(this),t.onFinish(this))},!1)},d=function(t){if("JSON"===t.type)return JSON.stringify(t.data);var e=[];for(var n in t.data){var i=t.data[n];e.push(n+"="+encodeURIComponent(i))}return e.join("&")};setHeaders=function(t,e){for(var n=t.headers,i=0;i<n.length;i++){var o=n[i];e.setRequestHeader(o.key,o.value)}},e.request=function(t){return new this(t).send()},e.prototype.send=function(){return xhr=a(this),h(this,xhr),xhr.send(d(this)),this},"function"==typeof define&&define.amd?define("ajax",[],function(){return e}):t.Ajax=e}(this);
